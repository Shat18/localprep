@model LocalPrep.Web.Models.responsedata

@{ ViewBag.Title = "Edit Meal";
    ViewBag.Span = Html.ActionLink("Add Meal", "AddMeal", "Manage",new { style = "font-size:18px;font-weight: bold" });
    //ViewBag.Span = Html.ActionLink("Add Meal", "EditMeal", "Manage");
    Layout = "~/Views/Shared/_AdminLayout.cshtml"; }
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" />
<link rel="stylesheet" href="css/style.css" />

@if (ViewBag.SuccessMessage != null && ViewBag.SuccessMessage.Length > 0)
{
<div class="alert alert-success">@ViewBag.SuccessMessage</div>}

@if (ViewBag.FailureMessage != null && ViewBag.FailureMessage.Length > 0)
{
<div class="alert alert-danger">@ViewBag.FailureMessage</div>}


<div class="col-lg-12 mb-5">
    <div class="shadow p-5 rounded-bottom ">

@using (Html.BeginForm("EditMeal", "Manage", FormMethod.Post, new { enctype = "multipart/form-data", @class = "form-horizontal", role = "form" }))
{
@Html.AntiForgeryToken()

                @Html.ValidationSummary("", new { @class = "text-danger" })
                                @Html.HiddenFor(m => m.id) @*@Html.HiddenFor(m => m.meal.MealId)                                                                                                               
                                                    @Html.HiddenFor(m => m.meal.SubmitDt)
                                                    @Html.HiddenFor(m => m.meal.VendorId)*@

                        <div class="form-group row">
                            @Html.LabelFor(m => m.name, new { @class = "col-md-12 control-label" })
                            <div class="col-md-12 mb-4">
                                @Html.TextBoxFor(m => m.name, new { @class = "form-control" })
                            </div>
                        </div> 
                        <div class="form-group row">
                            @Html.LabelFor(m => m.description, new { @class = "col-md-12 control-label" })
                        <div class="col-md-12 mb-4">
                           @Html.TextAreaFor(m => m.description, new { @class = "form-control", rows = "8", @id = "MealDescription" })
                         </div>
                          </div>

                    <div class="form-group row">
                        @Html.LabelFor(m => m.price, new { @class = "col-md-12 control-label" })
                        <div class="col-md-12 mb-4">
                            @Html.TextBoxFor(m => m.price, new { @class = "form-control" })
                        </div>
                    </div>
                    <div class="p-3 rounded mb-5" style="background:#fae9bb;">
                        <div class="form-group row">
                            <label class="col-md-12 control-label">Ingredients</label>
                            <div id="divIngredients">
                                @Html.HiddenFor(m => m.ingredientsl)
                                @Html.HiddenFor(m => m.ingredients)
                                @Html.Partial("~/Views/Manage/_Ingredient.cshtml", Model.ingredientsl)
                            </div>
                        </div>
                        <div class="form-group">
                            <div id="divIngredientsbutton">
                                <input type="button" id="btnIngredient" class="btn btningridient" value="Add Ingredient" />
                            </div>
                        </div>
                    </div>
                    <div class="p-3 rounded mb-5" style="background:#fae9bb;">
                        <div class="form-group row">
                            <label class="col-md-12 control-label">Meal Add-Ons</label>
                            <div id="divAddon">
                                @Html.HiddenFor(m => m.add_on)
                                @Html.Partial("~/Views/Manage/_AddOnMeal.cshtml", Model.add_on)
                            </div>                            
                        </div>
                        <div class="form-group">
                            <div id="divAddonbutton">
                                <input type="button" id="btnAddon" class="btn btnAddAddOn" value="Add Add-On" />
                            </div>
                        </div>
                    </div>
                     <div class="p-3 rounded mb-5" style="background:#fae9bb;">
                        <div class="form-group row">
                            <label class="col-md-12 control-label">Nutritional Information</label>

                            <div class="col-md-6">
                                <table class="table table-borderless">
                                    <tr>
                                        <td>
                                            Servings
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(m => m.nutritional_info[0].nutritional_value, new { @class = "form-control" })
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            Calories/Serving
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(m => m.nutritional_info[1].nutritional_value, new { @class = "form-control" })
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            Calories
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(m => m.nutritional_info[2].nutritional_value, new { @class = "form-control" })
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            Fat
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(m => m.nutritional_info[3].nutritional_value, new { @class = "form-control" })
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            Protein
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(m => m.nutritional_info[4].nutritional_value, new { @class = "form-control" })
                                        </td>
                                    </tr>
                                </table>

                            </div>
                            <div class="col-md-6">
                                <table class="table table-borderless">
                                    <tr>
                                        <td>
                                            Sugar
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(m => m.nutritional_info[5].nutritional_value, new { @class = "form-control" })
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            Sodium
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(m => m.nutritional_info[6].nutritional_value, new { @class = "form-control" })
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            Cholesterol
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(m => m.nutritional_info[7].nutritional_value, new { @class = "form-control" })
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            Total Carbohydrates
                                        </td>
                                        <td>
                                            @Html.TextBoxFor(m => m.nutritional_info[8].nutritional_value, new { @class = "form-control" })
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        </div>

                        <div class="form-group row">
                            @Html.LabelFor(m => m.heating_instructions, new { @class = "col-md-12 control-label" })
                            <div class="col-md-12 mb-4">
                                @Html.TextAreaFor(m => m.heating_instructions, new { @class = "form-control", rows = "8" })
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-md-12 mb-4">
                                @Html.LabelFor(m => m.DietsSelected)
                                <br />
                                <div class="row">
                                    @Html.EditorFor(x => x.lstdietspecialities, new { @required = "required" })
                                    <div class="col-md-3">
                                        @Html.TextBoxFor(m => m.Otherdiet, new { @class = "form-control", @id = "OtherDiets", style = "display:none" })
                                    </div>
                                </div>
                            </div>
                        </div> 
                        <div class="form-group row" style="margin-top: 24px;">
                            <div class="col-md-12 mb-4">
                                @Html.LabelFor(m => m.CuisinesSelected)
                                <br />
                                <div class="row">
                                    @Html.EditorFor(x => x.lstcuisinespecialities, new { @required = "required" })
                                    <div class="col-md-3">
                                        @Html.TextBoxFor(m => m.Othercuisine, new { @class = "form-control", @id = "OtherCuisines", style = "display:none" })
                                    </div>
                                </div>
                            </div>
                            </div>
                        
                        <div class="form-group custom-file mb-5">
                            @Html.LabelFor(m => m.image, new { @class = "custom-file-label" })
                            @Html.TextBoxFor(m => m.ImageFileE, new { @class = "form-control-file custom-file-input", @id = "fldupload", @type = "file" })

                            @Html.HiddenFor(x => x.image, new { @id = "hdnfilepath" })
                        </div>
                        if (Model.image.Count() > 0)
                        {
                        <div class="col-md-12">
                        <div class="col-md-3 mb-4 row">
                            @*<img src="@pic.ImgSrc" class="img-fluid" />*@
                            <img src="@Url.Content(@Model.image)" class="img-fluid" />
                            @*<p class="text-center">
                                <button class="btn btn-sm btn-danger" value="Remove">Remove</button>
                            </p>*@
                        </div>
                        </div>
                        } 
    
                        <div class="form-group row mb-4">
                                @*<label class="col-md-12"></label>*@
                                <div class="col-md-12">
                                    <div class="checkbox">
                                        @Html.CheckBoxFor(m => m.active)
                                        @Html.LabelFor(m => m.status)
                                    </div>
                                </div>
                        </div>

                        <div class="form-group row">
                            <div class="col-md-12">
                                <input type="submit" class="btn btn-lp" value="Edit Meal" />
                                @*<input type="submit" class="btn btn-lp" value="Edit Meal" />*@
                            </div>
                        </div>
                        }
    </div>

</div>




<script src="https://cdn.jsdelivr.net/npm/bs-custom-file-input/dist/bs-custom-file-input.min.js"></script>
                        @section Scripts {
                            <script type="text/javascript">
                                $('body').on('click', '#lstdietspecialities_5__IsChecked', function () {
                                    
                                    //$('.CustCreditCardCvv).hide();

                                    if ($('#lstdietspecialities_5__IsChecked').is(':checked')) {
                                        $("#OtherDiets").css("display", "block");
                                    }
                                    else {
                                        $("#OtherDiets").css("display", "none");
                                    }

                                    //$(".expdate").css("display", "block")
                                    //var value = $(this).attr("data-id");
                                    //$('#CreditCardCvv_' + value).show();
                                    //$('#expdate_' + value).hide();
                                })

                                $('body').on('click', '#lstcuisinespecialities_6__IsChecked', function () {
                                    //alert("heloo");
                                    //$('.CustCreditCardCvv).hide();

                                    if ($('#lstcuisinespecialities_6__IsChecked').is(':checked')) {
                                        $("#OtherCuisines").css("display", "block");
                                    }
                                    else {
                                        $("#OtherCuisines").css("display", "none");
                                    }

                                    //$(".expdate").css("display", "block")
                                    //var value = $(this).attr("data-id");
                                    //$('#CreditCardCvv_' + value).show();
                                    //$('#expdate_' + value).hide();
                                })

                                $(document).ready(function () {
                                    $('.noIngredients').hide();
                                    $('.noAddOns').hide();
                                    bsCustomFileInput.init()
                                    if ($('#lstdietspecialities_5__IsChecked').is(':checked')) {
                                        $("#OtherDiets").css("display", "block");
                                    }
                                    else {
                                        $("#OtherDiets").css("display", "none");
                                    }

                                    if ($('#lstcuisinespecialities_6__IsChecked').is(':checked')) {
                                        $("#OtherCuisines").css("display", "block");
                                    }
                                    else {
                                        $("#OtherCuisines").css("display", "none");
                                    }
                                })
                                $(function () {
                                    $('.btnAddIngredient').click(function (e) {
                                        //    $('.btnAddIngredient').prop('disabled', true);

                                        //    if ($('#txtAddIngredient').val().length > 0) {

                                        //        $.ajax({
                                        //            url: "/Manage/AddIngredient",
                                        //            type: "POST",
                                        //            dataType: "json",
                                        //            traditional: true,
                                        //            data: JSON.stringify({ 'mealId': $('#meal_MealId').val(), 'ingredientName': $('#txtAddIngredient').val() }),
                                        //            contentType: "application/json; charset=utf-8",
                                        //            success: function (data) {
                                        //                $('#noIngredients').hide();
                                        //                $('#tblIngredients').append("<tr><td>" + data.IngredientName + "</td><td><input type=\"button\" class=\"btn btn-sm btn-danger rmvIng\" value=\"Remove\" data-id=\"" + data.MealIngredientId + "\" /></td></tr>");
                                        //                $('#txtAddIngredient').val("");
                                        //                $('.btnAddIngredient').prop('disabled', false);
                                        //            },
                                        //            error: function (xhr, ajaxOptions, errorThrown) {
                                        //                alert('nope!');
                                        //                //alert(xhr.responseText);
                                        //                $('#msg').show();
                                        //                $('#msg').addClass("alert-danger");
                                        //                $('#msg').html("<strong>Error:</strong> " + xhr.responseText);
                                        //            }
                                        //        });
                                        //    } else {
                                        //        alert('Please add an ingredient before submitting.');
                                        //        $('.btnAddIngredient').prop('disabled', false);
                                        //    }
                                        //});

                                        //var customers = new Array();
                                        //$('.btnAddIngredient').prop('disabled', true);

                                        //if ($('#txtAddIngredient').val().length > 0) {
                                        //    var mealId = 1
                                        //    var ingredientName = $('#txtAddIngredient').val();
                                        //    $('#noIngredients').hide();
                                        //    $('#tblIngredients').append("<tr><td>" + ingredientName + "</td><td><input type=\"button\" class=\"btn btn-sm btn-danger rmvIng\" value=\"Remove\" data-id=\"" + mealId + "\" /></td></tr>");
                                        //    $('#txtAddIngredient').val("");
                                        //    $('.btnAddIngredient').prop('disabled', false);

                                        //}
                                    });



                                    $("#divIngredientsbutton .btningridient").on("click", function () {
                                        $('.btnAddIngredient').prop('disabled', true);

                                        if ($('#txtingredientname').val().length > 0) {

                                            var listIngredients = [];
                                            $("#tblIngredients tr.item").each(function () {
                                                lstIngredient = { IngredientName: $(this).find("#txtingredientname").val() };
                                                listIngredients.push(lstIngredient);
                                                //alert(JSON.stringify(lstIngredient));
                                            });
                                            lstaddIngredient = JSON.stringify({ 'lstaddIngredient': listIngredients });

                                            /* alert(JSON.stringify(lstaddIngredient));*/

                                            $.ajax({
                                                url: "/Manage/AddIngredients",
                                                type: "Post",
                                                dataType: "text",
                                                traditional: true,
                                                data: lstaddIngredient,
                                                contentType: "application/json; charset=utf-8",
                                                success: function (data) {
                                                    $('.noIngredients').hide();
                                                    $("#divIngredients").html(data);
                                                },
                                                error: function (xhr, ajaxOptions, errorThrown) {

                                                }
                                            });
                                        }
                                        else {
                                            alert('Please add an ingredient before submitting.');
                                            /*$('.btnAddIngredient').prop('disabled', false);*/
                                        }
                                    });

                                    $("#divAddonbutton .btnAddAddOn").on("click", function () {

                                        /*$('.btnAddAddOn').prop('disabled', true);*/

                                        if ($('#txtaddonname').val().length > 0 && $('#txtaddonprice').val().length > 0) {
                                            var listaddons = [];
                                            $("#tblAddOns tr.item").each(function () {
                                                lstaddon = { add_on_price: $(this).find("#txtaddonprice").val(), add_on_name: $(this).find("#txtaddonname").val() };
                                                listaddons.push(lstaddon);

                                            });

                                            lstaddons = JSON.stringify({ 'lstaddon': listaddons });


                                            $.ajax({
                                                contentType: 'application/json; charset=utf-8',
                                                dataType: 'text',
                                                type: 'POST',
                                                url: '/Manage/AddonMeal',
                                                data: lstaddons,
                                                success: function (data) {
                                                    $('.noAddOns').hide();
                                                    $("#divAddon").html(data);
                                                },
                                                error: function () {
                                                    //alert('nope!');
                                                    ////alert(xhr.responseText);
                                                    //$('#msg').show();
                                                    //$('#msg').addClass("alert-danger");
                                                    //$('#msg').html("<strong>Error:</strong> " + xhr.responseText);
                                                    //alert("dfhsdfh");
                                                    //$("#divAddon").html(data);
                                                }
                                            });
                                        } else {
                                            alert('Please add an Add-On Name and Price before submitting.');
                                            /* $('.btnAddAddOn').prop('disabled', false);*/
                                        }
                                    });


                                    $('.rmvIng').click(function (e) {
                                        var remIng = $(this);
                                        $.ajax({
                                            url: "/Manage/RemoveIngredient",
                                            type: "POST",
                                            //dataType: "json",
                                            traditional: true,
                                            data: JSON.stringify({ 'mealIngredientId': $(this).data("id") }),
                                            contentType: "application/json; charset=utf-8",
                                            success: function (data) {
                                                if (data == "success") {
                                                    remIng.closest('tr').remove();
                                                }
                                            },
                                            error: function (xhr, ajaxOptions, errorThrown) {
                                                alert('nope!');
                                                //alert(xhr.responseText);
                                                $('#msg').show();
                                                $('#msg').addClass("alert-danger");
                                                $('#msg').html("<strong>Error:</strong> " + xhr.responseText);
                                            }
                                        });
                                    });

                                    //$('.btnAddAddOn').click(function (e) {
                                    //    $('.btnAddAddOn').prop('disabled', true);

                                    //    if ($('#txtAddAddOn').val().length > 0 && $('#txtAddAddOnPrice').val().length > 0) {

                                    //        $.ajax({
                                    //            url: "/Manage/AddAddOn",
                                    //            type: "POST",
                                    //            dataType: "json",
                                    //            traditional: true,
                                    //            data: JSON.stringify({ 'mealId': $('#meal_MealId').val(), 'addOnName': $('#txtAddAddOn').val(), 'addOnPrice': $('#txtAddAddOnPrice').val() }),
                                    //            contentType: "application/json; charset=utf-8",
                                    //            success: function (data) {
                                    //                console.log(data);
                                    //                $('#noAddOns').hide();
                                    //                $('#tblAddOns').append("<tr><td>" + data.MealAddOnName + "</td><td>$" + data.MealAddOnPrice + "</td><td><input type=\"button\" class=\"btn btn-sm btn-danger rmvIng\" value=\"Remove\" data-id=\"" + data.MealIngredientId + "\" /></td></tr>");
                                    //                $('#txtAddAddOn').val("");
                                    //                $('#txtAddAddOnPrice').val("");
                                    //                $('.btnAddAddOn').prop('disabled', false);
                                    //            },
                                    //            error: function (xhr, ajaxOptions, errorThrown) {
                                    //                alert('nope!');
                                    //                //alert(xhr.responseText);
                                    //                $('#msg').show();
                                    //                $('#msg').addClass("alert-danger");
                                    //                $('#msg').html("<strong>Error:</strong> " + xhr.responseText);
                                    //            }
                                    //        });
                                    //    } else {
                                    //        alert('Please add an Add-On Name and Price before submitting.');
                                    //        $('.btnAddAddOn').prop('disabled', false);
                                    //    }
                                    //});


                                    //$('.btnAddAddOn').click(function (e) {
                                    //    $('.btnAddAddOn').prop('disabled', true);

                                    //    if ($('#txtAddAddOn').val().length > 0 && $('#txtAddAddOnPrice').val().length > 0) {
                                    //        var addOnName = $('#txtAddAddOn').val();
                                    //        var addOnPrice = $('#txtAddAddOnPrice').val();
                                    //        var Peal = 2;
                                    //        //var mealId = 1;

                                    //        $('#noAddOns').hide();
                                    //        $('#tblAddOns').append("<tr><td>" + addOnName + "</td><td>$" + addOnPrice + "</td><td><input type=\"button\" class=\"btn btn-sm btn-danger rmvIng\" value=\"Remove\" data-id=\"" + Peal + "\" /></td></tr>");
                                    //        $('#txtAddAddOn').val("");
                                    //        $('#txtAddAddOnPrice').val("");
                                    //        $('.btnAddAddOn').prop('disabled', false);
                                    //    }


                                    //});
                                });
                            </script>
                        }

                        @*@section Scripts {
            <script type="text/javascript">
                $(function () {
                    $('.btnAddIngredient').click(function (e) {
                        $('.btnAddIngredient').prop('disabled', true);

                        if ($('#txtAddIngredient').val().length > 0) {

                            $.ajax({
                                url: "/Manage/AddIngredient",
                                type: "POST",
                                dataType: "json",
                                traditional: true,
                                data: JSON.stringify({ 'mealId': $('#meal_MealId').val(), 'ingredientName': $('#txtAddIngredient').val() }),
                                contentType: "application/json; charset=utf-8",
                                success: function (data) {
                                    $('#noIngredients').hide();
                                    $('#tblIngredients').append("<tr><td>" + data.IngredientName + "</td><td><input type=\"button\" class=\"btn btn-sm btn-danger rmvIng\" value=\"Remove\" data-id=\"" + data.MealIngredientId + "\" /></td></tr>");
                                    $('#txtAddIngredient').val("");
                                    $('.btnAddIngredient').prop('disabled', false);
                                },
                                error: function (xhr, ajaxOptions, errorThrown) {
                                    alert('nope!');
                                    //alert(xhr.responseText);
                                    $('#msg').show();
                                    $('#msg').addClass("alert-danger");
                                    $('#msg').html("<strong>Error:</strong> " + xhr.responseText);
                                }
                            });
                        } else {
                            alert('Please add an ingredient before submitting.');
                            $('.btnAddIngredient').prop('disabled', false);
                        }
                    });

                    $('.rmvIng').click(function (e) {
                        var remIng = $(this);
                        $.ajax({
                            url: "/Manage/RemoveIngredient",
                            type: "POST",
                            //dataType: "json",
                            traditional: true,
                            data: JSON.stringify({ 'mealIngredientId': $(this).data("id") }),
                            contentType: "application/json; charset=utf-8",
                            success: function (data) {
                                if (data == "success") {
                                    remIng.closest('tr').remove();
                                }
                            },
                            error: function (xhr, ajaxOptions, errorThrown) {
                                alert('nope!');
                                //alert(xhr.responseText);
                                $('#msg').show();
                                $('#msg').addClass("alert-danger");
                                $('#msg').html("<strong>Error:</strong> " + xhr.responseText);
                            }
                        });
                    });

                    $('.btnAddAddOn').click(function (e) {
                        $('.btnAddAddOn').prop('disabled', true);

                        if ($('#txtAddAddOn').val().length > 0 && $('#txtAddAddOnPrice').val().length > 0) {

                            $.ajax({
                                url: "/Manage/AddAddOn",
                                type: "POST",
                                dataType: "json",
                                traditional: true,
                                data: JSON.stringify({ 'mealId': $('#meal_MealId').val(), 'addOnName': $('#txtAddAddOn').val(), 'addOnPrice': $('#txtAddAddOnPrice').val() }),
                                contentType: "application/json; charset=utf-8",
                                success: function (data) {
                                    console.log(data);
                                    $('#noAddOns').hide();
                                    $('#tblAddOns').append("<tr><td>" + data.MealAddOnName + "</td><td>$" + data.MealAddOnPrice + "</td><td><input type=\"button\" class=\"btn btn-sm btn-danger rmvIng\" value=\"Remove\" data-id=\"" + data.MealIngredientId + "\" /></td></tr>");
                                    $('#txtAddAddOn').val("");
                                    $('#txtAddAddOnPrice').val("");
                                    $('.btnAddAddOn').prop('disabled', false);
                                },
                                error: function (xhr, ajaxOptions, errorThrown) {
                                    alert('nope!');
                                    //alert(xhr.responseText);
                                    $('#msg').show();
                                    $('#msg').addClass("alert-danger");
                                    $('#msg').html("<strong>Error:</strong> " + xhr.responseText);
                                }
                            });
                        } else {
                            alert('Please add an Add-On Name and Price before submitting.');
                            $('.btnAddAddOn').prop('disabled', false);
                        }
                    });
                });
            </script>
        }*@
