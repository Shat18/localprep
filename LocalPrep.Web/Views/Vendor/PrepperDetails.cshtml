@*@model Meal*@
@model LocalPrep.Web.Models.ResponseSearch
@using Microsoft.AspNet.Identity
@{ ViewBag.Title = "Order Meal"; }


<section id="page-content" style="padding: 0px;">
    <div class="container-fullscreen">
        <div class="col-md-12 blue-spec-bg">
            <h1 class="text-center">@Model.response.name</h1>
        </div>
    </div>
</section>

<section id="product-page" class="product-page p-b-0">
    <div class="container">
        <div class="product">
            <div class="row m-b-40">
                <div class="col-lg-5 text-center">
                    <div class="product-image">
                        <ul id="imageGallery">
                            @if (Model.response.image.Count() == 0)
                            {
                <li data-thumb="~/img/coming_soon.jpg">
                    <img src="~/img/coming_soon.jpg" />
                </li>
 }
            else
            {
<li data-thumb="@Model.response.image">
    <img src="@Model.response.image" alt="@Model.response.name" />
</li> @*foreach (var pic in Model.image)
                                    {
                    <li data-thumb="@pic.">
                        <img src="@pic.ImgSrc" alt="@Model.name" />
                    </li>}*@}
                        </ul>

                    </div>
                    <h3 class="text-orange my-2">
                        @Model.response.name
                    </h3>
                    <p>0.36 Miles</p>

                    <div class="product-rate d-inline-block float-none">
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star-half-o"></i>
                    </div>
                </div>
                <div class="col-lg-7">
                    <!-- Product additional tabs -->
                    <div class="tabs tabs-folder">
                        <ul class="nav nav-tabs" id="myTab3" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link show active" id="home-tab" data-toggle="tab" href="#nutritionfacts" role="tab" aria-controls="home" aria-selected="true"><i class="fa fa-align-justify"></i>Menu</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="profile-tab" data-toggle="tab" href="#reviews" role="tab" aria-controls="profile" aria-selected="false">
                                    <i class="fa fa-star"></i>Reviews
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="contact-tab" data-toggle="tab" href="#detail" role="tab" aria-controls="contact" aria-selected="false"><i class="fa fa-info"></i> Detail</a>
                            </li>
                        </ul>
                        <div class="tab-content" id="myTabContent3">
                            <div class="tab-pane fade active show" id="nutritionfacts" role="tabpanel" aria-labelledby="home-tab">
                                <div class="row">
                                    @for (var i = 0; i < Model.response.meals.data.Count; i++)
                                    {
                        <div class="col-lg-4 col-md-6 mb-5">
                            <a href="@Url.Action("Meal", "Order")?mealId=@Model.response.meals.data[i].id" class="shadow text-center d-block">
                                <div class="list-img"><img src="@Model.response.meals.data[i].image" alt="Garth" class="marker-pin-img img-fluid"></div><div class="list-detail p-2">
                                    <h3 class="orange my-3">@Model.response.meals.data[i].name</h3><div class="product-rate float-none d-inline-block">
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star"></i>
                                        <i class="fa fa-star-half-o"></i>
                                    @*</div><p>0.36 miles</p>*@
                                </div><div></div>
                            </a>
                        </div>}



                                </div>
                            </div>

                            <div class="tab-pane fade" id="reviews" role="tabpanel" aria-labelledby="contact-tab">
                                <div class="comments" id="comments">
                                    <div class="comment_number">
                                        Reviews <span>(@Model.response.meals.data.Count)</span>
                                    </div>
                                   
                                    <div class="comment-list">
                                        <a href="@Url.Action("Leave", "Review", new { mealId = 2 })">Leave a review</a>
                                        <div id="review"></div>
                                        @*<div class="border-bottom pb-4 mb-4" id="review">

                                            </div>*@

                                    </div>
                                </div>
                            </div>

                            <div class="tab-pane fade" id="detail" role="tabpanel" aria-labelledby="profile-tab">

                                <div class="mb-5">

                                    <div class="d-flex mb-4">
                                        <div class="mr-4" style="width:40px;">
                                            <svg aria-hidden="true" focusable="false" data-prefix="far" data-icon="user" width="20" class="svg-inline--fa fa-user fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M313.6 304c-28.7 0-42.5 16-89.6 16-47.1 0-60.8-16-89.6-16C60.2 304 0 364.2 0 438.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-25.6c0-74.2-60.2-134.4-134.4-134.4zM400 464H48v-25.6c0-47.6 38.8-86.4 86.4-86.4 14.6 0 38.3 16 89.6 16 51.7 0 74.9-16 89.6-16 47.6 0 86.4 38.8 86.4 86.4V464zM224 288c79.5 0 144-64.5 144-144S303.5 0 224 0 80 64.5 80 144s64.5 144 144 144zm0-240c52.9 0 96 43.1 96 96s-43.1 96-96 96-96-43.1-96-96 43.1-96 96-96z"></path></svg>
                                        </div>
                                        <div class="text16 align-self-center">
                                            @Model.response.name                                           

                                        </div>
                                    </div>
                                    <div class="d-flex mb-4 ">
                                        <div class="mr-4" style="width:40px;">
                                            <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="phone-alt" width="20" class="svg-inline--fa fa-phone-alt fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M497.39 361.8l-112-48a24 24 0 0 0-28 6.9l-49.6 60.6A370.66 370.66 0 0 1 130.6 204.11l60.6-49.6a23.94 23.94 0 0 0 6.9-28l-48-112A24.16 24.16 0 0 0 122.6.61l-104 24A24 24 0 0 0 0 48c0 256.5 207.9 464 464 464a24 24 0 0 0 23.4-18.6l24-104a24.29 24.29 0 0 0-14.01-27.6z"></path></svg>
                                        </div>
                                        <div class="text16 align-self-center">
                                            @Model.response.phone

                                        </div>
                                    </div>
                                    <div class="d-flex mb-4 ">
                                        <div class="mr-4" style="width:40px;">
                                            <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="location-arrow" width="20" class="svg-inline--fa fa-location-arrow fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M444.52 3.52L28.74 195.42c-47.97 22.39-31.98 92.75 19.19 92.75h175.91v175.91c0 51.17 70.36 67.17 92.75 19.19l191.9-415.78c15.99-38.39-25.59-79.97-63.97-63.97z"></path></svg>
                                        </div>
                                        <div class="text16">
                                            Address<br>
                                                   @*<div class="text-black-50">
                                                       @Model.response.company_address.address_line_1,<br>
                                                       @Model.response.company_address.state, USA
                                                   </div>*@

                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                    <!-- end: Product additional tabs -->
                </div>
            </div>

        </div>
    </div>
</section>

@section Scripts
{

    <script type="text/javascript">


        $(function () {
            $('#reviews').click()
            {
                //alert(2);
                $.ajax({
                    url: "/Vendor/Getreviews",
                    type: "POST",
                    dataType: "json",
                    traditional: true,
                    data: JSON.stringify({ 'mealId': 2 }),
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        //alert(JSON.stringify(data))
                        for (i = 0; i < data.length; i++) {
                            //alert(JSON.stringify(data[i].name));
                            $("#review").append("<div class=\"border-bottom pb-4 mb-4\"><div class=\"text\"><h5 class=\"name\">" + data[i].customer_first_name + " " + data[i].customer_last_name + "</h5><div class=\"product-rate float-none d-inline-block\"><div class=\"rateit\" data-rateit-mode=\"font\" data-rateit-value=" + 3 + " data-rateit-ispreset=\"true\" data-rateit-readonly=\"true\"></div></div><div class=\"text_holder\"><p>" + data[i].comment + "</p></div></div></div>")

                        }


                    },
                    error: function (xhr, ajaxOptions, errorThrown) {
                        console.log(xhr);
                        console.log(ajaxOptions);
                        console.log(errorThrown);
                    }
                });
            }

            $('#AddToCart').click(function (e) {
                $('#AddToCart').prop('disabled', true);

                var removeIngredientsChecked = []
                $('.rmvIngredientsCheck:checked').each(function () {
                    removeIngredientsChecked.push($(this).val());
                });

                var addOnChecked = []
                $('.addOnCheck:checked').each(function () {
                    addOnChecked.push($(this).val());
                });

                $.ajax({
                    url: "/Cart/AddToCart",
                    type: "POST",
                    dataType: "json",
                    traditional: true,
                    data: JSON.stringify({ 'mealId': $('#mealId').val(), 'pickupDelivery': $('#pickupDelivery').val(), 'pickupDeliveryDt': $('#pickupDeliveryDt').val(), 'removeIngredients': removeIngredientsChecked, 'addOns': addOnChecked, 'mealQty': $('#txtQty').val() }),
                    contentType: "application/json; charset=utf-8",
                    success: function (data) {
                        if (data == "Success") {
                            $('#resultMsg').html("<div class=\"alert alert-success alert-dismissible fade show\" role=\"alert\">Meal has been added to your cart! <a href=\"/Cart\">View Cart</a><button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">×</span></button></div>")
                            var cartCount = $('#cartbadge').text();
                            $('#cartbadge').text(parseInt(cartCount) + 1);
                        } else {
                            $('#resultMsg').html("<div class=\"alert alert-danger alert-dismissible fade show\" role=\"alert\">Error occurred.  Meal was not able to be added to your cart at this time.  Please be sure to create an account before adding an item to your cart.<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">×</span></button></div>")
                        }
                    },
                    error: function (xhr, ajaxOptions, errorThrown) {
                        console.log(xhr);
                        console.log(ajaxOptions);
                        console.log(errorThrown);
                    }
                });

                $('#AddToCart').prop('disabled', false);
            });

            $('.addOnCheck').change(function () {
                var curPrice = parseFloat($('#mealPrice').text());
                var priceChange = parseFloat($(this).data("price"));

                if (this.checked) {
                    $('#mealPrice').text(curPrice + priceChange);
                } else {
                    $('#mealPrice').text(curPrice - priceChange);
                }
            });

            $('#imageGallery').lightSlider({
                gallery: true,
                item: 1,
                loop: true,
                thumbItem: 9,
                slideMargin: 0,
                enableDrag: false,
                currentPagerPosition: 'left',
                onSliderLoad: function (el) {
                    el.lightGallery({
                        selector: '#imageGallery .lslide'
                    });
                }
            });
            //data: JSON.stringify({ 'mealId': $('#mealId').val() }),
            //$('#reviews').click(function (e) {
            //    $('#AddToCart').prop('disabled', true);
            //    alert(1);

            //    $.ajax({
            //        url: "/Vendor/Getreviews",
            //        type: "POST",
            //        dataType: "json",
            //        traditional: true,
            //        data: JSON.stringify({ 'mealId': 2}),
            //        contentType: "application/json; charset=utf-8",
            //        success: function (data) {
            //            if (data == "Success") {
            //                $('#resultMsg').html("<div class=\"alert alert-success alert-dismissible fade show\" role=\"alert\">Meal has been added to your cart! <a href=\"/Cart\">View Cart</a><button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">×</span></button></div>")
            //                var cartCount = $('#cartbadge').text();
            //                $('#cartbadge').text(parseInt(cartCount) + 1);
            //            } else {
            //                $('#resultMsg').html("<div class=\"alert alert-danger alert-dismissible fade show\" role=\"alert\">Error occurred.  Meal was not able to be added to your cart at this time.  Please be sure to create an account before adding an item to your cart.<button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"><span aria-hidden=\"true\">×</span></button></div>")
            //            }
            //        },
            //        error: function (xhr, ajaxOptions, errorThrown) {
            //            console.log(xhr);
            //            console.log(ajaxOptions);
            //            console.log(errorThrown);
            //        }
            //    });

            //    $('#AddToCart').prop('disabled', false);
            //});
        });</script>

    <script src="~/plugins/rateit/jquery.rateit.min.js"></script>
    <link rel="stylesheet" href="~/plugins/rateit/rateit.css">
}